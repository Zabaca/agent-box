# Lima VM configuration for Claude Code
# Usage: limactl start claude-vm.yaml

images:
  - location: "https://cloud-images.ubuntu.com/releases/24.04/release/ubuntu-24.04-server-cloudimg-arm64.img"
    arch: "aarch64"

cpus: 2
memory: "4GiB"
disk: "20GiB"

# Disable default hostâ†’guest mounts (we do the reverse)
mounts: []

provision:
  - mode: system
    script: |
      #!/bin/bash
      set -eux
      export DEBIAN_FRONTEND=noninteractive

      apt-get update
      apt-get install -y docker.io nodejs npm git unzip

      # Install Claude Code CLI
      npm install -g @anthropic-ai/claude-code --no-audit

      # Create workspace directory with open permissions (user script will fix)
      mkdir -p /agent-workspace
      chmod 777 /agent-workspace

  - mode: user
    script: |
      #!/bin/bash
      set -eux

      # Fix workspace ownership (runs as the lima user)
      sudo chown -R "$(whoami):$(whoami)" /agent-workspace
      sudo chmod 755 /agent-workspace

      # Add self to docker group
      sudo usermod -aG docker "$(whoami)"
