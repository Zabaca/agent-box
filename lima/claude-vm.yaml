# Lima VM configuration for Claude Code
# Usage: limactl start claude-vm.yaml

images:
  - location: "https://cloud-images.ubuntu.com/releases/24.04/release/ubuntu-24.04-server-cloudimg-arm64.img"
    arch: "aarch64"

cpus: 2
memory: "4GiB"
disk: "20GiB"

# Disable default hostâ†’guest mounts (we do the reverse)
mounts: []

provision:
  - mode: system
    script: |
      #!/bin/bash
      set -eux
      export DEBIAN_FRONTEND=noninteractive

      apt-get update
      apt-get install -y docker.io nodejs npm git unzip

      # Install Claude Code CLI
      npm install -g @anthropic-ai/claude-code --no-audit

      # Create workspace directory
      mkdir -p /agent-workspace

      # Find the non-root user (Lima creates user with same name as host)
      LIMA_USER=$(getent passwd 1000 | cut -d: -f1)

      # Add user to docker group and set ownership
      usermod -aG docker "$LIMA_USER"
      chown -R "$LIMA_USER:$LIMA_USER" /agent-workspace
